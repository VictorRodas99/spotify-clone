---
import type { Song } from '@lib/types/general'
import { formatSeconds } from '@utils/general'
import PlayIcon from '@icons/PlayIcon'
import MenuIcon from '@icons/MenuIcon.astro'
import { Image } from 'astro:assets'

// TODO: fix null
interface Props {
  songs: (Song | null)[]
  section?: 'album' | 'playlist'
}

const { songs, section } = Astro.props
const isPlaylist = section === 'playlist'
---

<ul>
  {
    songs.map((track, index) => (
      <li
        class:list={[
          'grid w-full px-5 py-2 hover:bg-primary-dark-50 group rounded-md',
          { 'grid-cols-3': isPlaylist, 'grid-cols-2': !isPlaylist }
        ]}
      >
        <div class="flex gap-5 items-center">
          <div class="h-full min-w-[25px] text-center grid items-center">
            <span class="text-light group-hover:hidden">{index + 1}</span>
            <span class="hidden group-hover:block">
              <PlayIcon size={22} />
            </span>
          </div>

          <div class="flex gap-2 items-center">
            {isPlaylist && (
              <picture>
                <Image
                  src={track?.album.coverBig ?? ''}
                  alt={`Cover de ${track?.album.title}`}
                  width={40}
                  height={40}
                  class="object-cover rounded-md"
                />
              </picture>
            )}

            <div>
              <p>{track?.title}</p>
              <p class="text-light text-sm">{track?.artist}</p>
            </div>
          </div>
        </div>

        {isPlaylist && (
          <div class="flex justify-start items-center text-light text-sm hover:text-white hover:underline transition-colors">
            <a href={`/album/${track?.album.id}`}>{track?.album.title}</a>
          </div>
        )}

        <div class="flex items-center justify-end gap-2">
          <span class="text-sm text-light">
            {formatSeconds(track?.durationSeconds ?? 0)}
          </span>
          <button class="invisible group-hover:visible">
            <MenuIcon size={24} />
          </button>
        </div>
      </li>
    ))
  }
</ul>
